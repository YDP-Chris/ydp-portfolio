<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PulseCheck - Your D365 jobs at a glance âš¡</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        .pulse-red {
            animation: pulse-red 2s ease-in-out infinite;
        }
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        .job-circle {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .job-circle:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .notification {
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Mock data that simulates real D365 jobs
        const generateMockJobs = () => {
            const jobNames = [
                'Customer Import', 'Invoice Processing', 'Inventory Sync', 'Financial Reporting',
                'Data Warehouse Update', 'Email Campaign', 'User Sync', 'Sales Analytics',
                'Product Catalog', 'Order Processing', 'Payment Gateway', 'Backup Routine',
                'Security Audit', 'Performance Metrics', 'Tax Calculation', 'Shipping Labels',
                'CRM Integration', 'Report Generation', 'Data Cleansing', 'API Sync',
                'Workflow Engine', 'Notification Service', 'Archive Process', 'Quality Check',
                'Price Updates', 'Stock Reconciliation', 'Customer Segmentation', 'Marketing Automation',
                'Compliance Check', 'Data Export', 'System Maintenance', 'Log Rotation',
                'Cache Refresh', 'Index Rebuild', 'Batch Reconciliation', 'Document Processing',
                'Integration Monitor', 'Health Check', 'Resource Cleanup', 'Queue Processing',
                'Event Processing', 'File Transfer', 'Database Sync', 'Monitoring Service',
                'Alert Processing', 'Scheduled Tasks', 'Data Migration'
            ];

            const statuses = ['running', 'running', 'running', 'running', 'running', 'delayed', 'failed'];
            const now = new Date();

            return jobNames.map((name, index) => {
                const status = statuses[Math.floor(Math.random() * statuses.length)];
                let lastRun, lastSuccess;

                if (status === 'running') {
                    lastRun = new Date(now - Math.random() * 30 * 60 * 1000); // Last 30 minutes
                    lastSuccess = lastRun;
                } else if (status === 'delayed') {
                    lastRun = new Date(now - (2 + Math.random() * 4) * 60 * 60 * 1000); // 2-6 hours ago
                    lastSuccess = new Date(now - Math.random() * 24 * 60 * 60 * 1000); // Last 24 hours
                } else {
                    lastRun = new Date(now - (2 + Math.random() * 12) * 60 * 60 * 1000); // 2-14 hours ago
                    lastSuccess = new Date(now - (12 + Math.random() * 48) * 60 * 60 * 1000); // 12-60 hours ago
                }

                return {
                    id: index + 1,
                    name,
                    status,
                    lastRun,
                    lastSuccess
                };
            });
        };

        const formatTimeAgo = (date) => {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${days}d ago`;
        };

        const getStatusColor = (status) => {
            switch (status) {
                case 'running': return 'bg-green-500';
                case 'delayed': return 'bg-yellow-500';
                case 'failed': return 'bg-red-500';
                default: return 'bg-gray-500';
            }
        };

        const getStatusText = (status) => {
            switch (status) {
                case 'running': return 'Running';
                case 'delayed': return 'Delayed';
                case 'failed': return 'Failed';
                default: return 'Unknown';
            }
        };

        function PulseCheck() {
            const [jobs, setJobs] = useState([]);
            const [selectedJob, setSelectedJob] = useState(null);
            const [showNotification, setShowNotification] = useState(false);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                // Simulate loading D365 data
                const timer = setTimeout(() => {
                    setJobs(generateMockJobs());
                    setLoading(false);
                    
                    // Show morning notification after load
                    setTimeout(() => {
                        setShowNotification(true);
                        setTimeout(() => setShowNotification(false), 4000);
                    }, 1000);
                }, 1500);

                return () => clearTimeout(timer);
            }, []);

            const handleJobClick = (job) => {
                setSelectedJob(job);
            };

            const closeModal = () => {
                setSelectedJob(null);
            };

            const getHealthSummary = () => {
                const running = jobs.filter(j => j.status === 'running').length;
                const failed = jobs.filter(j => j.status === 'failed').length;
                const delayed = jobs.filter(j => j.status === 'delayed').length;
                
                if (failed > 0) {
                    return {
                        icon: 'ðŸ”´',
                        text: `${running} jobs healthy, ${failed + delayed} need attention`
                    };
                } else if (delayed > 0) {
                    return {
                        icon: 'ðŸŸ¡',
                        text: `${running} jobs healthy, ${delayed} running slow`
                    };
                } else {
                    return {
                        icon: 'ðŸŸ¢',
                        text: `All systems green - ${running} jobs running smoothly`
                    };
                }
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-white flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                            <p className="text-gray-600 text-lg">Loading D365 jobs...</p>
                        </div>
                    </div>
                );
            }

            const summary = getHealthSummary();

            return (
                <div className="min-h-screen bg-white relative">
                    {/* Notification */}
                    {showNotification && (
                        <div className="fixed top-4 left-4 right-4 z-50 notification fade-in">
                            <div className="bg-white/90 backdrop-blur-sm border border-gray-200 rounded-lg p-4 shadow-lg max-w-md mx-auto">
                                <div className="flex items-center gap-3">
                                    <span className="text-2xl">{summary.icon}</span>
                                    <div>
                                        <p className="font-medium text-gray-900">D365 Health Check</p>
                                        <p className="text-sm text-gray-600">{summary.text}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Header */}
                    <div className="bg-white border-b border-gray-200 px-4 py-6">
                        <div className="max-w-6xl mx-auto">
                            <h1 className="text-2xl font-bold text-gray-900 mb-2">
                                PulseCheck âš¡
                            </h1>
                            <p className="text-gray-600">Your D365 jobs at a glance</p>
                            <div className="mt-4 flex items-center gap-2 text-sm">
                                <span className="text-2xl">{summary.icon}</span>
                                <span className="text-gray-700">{summary.text}</span>
                            </div>
                        </div>
                    </div>

                    {/* Jobs Grid */}
                    <div className="max-w-6xl mx-auto px-4 py-8 fade-in">
                        <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-6">
                            {jobs.map((job) => (
                                <button
                                    key={job.id}
                                    onClick={() => handleJobClick(job)}
                                    className={`job-circle flex flex-col items-center p-3 rounded-lg border-2 border-transparent hover:border-gray-200 focus:outline-none focus:border-blue-500 ${
                                        job.status === 'failed' ? 'pulse-red' : ''
                                    }`}
                                >
                                    <div className={`w-16 h-16 rounded-full ${getStatusColor(job.status)} mb-2 flex items-center justify-center`}>
                                        <div className="w-3 h-3 bg-white rounded-full opacity-30"></div>
                                    </div>
                                    <p className="text-xs text-gray-700 text-center font-medium leading-tight">
                                        {job.name}
                                    </p>
                                    <p className="text-xs text-gray-500 mt-1">
                                        {formatTimeAgo(job.lastRun)}
                                    </p>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Job Detail Modal */}
                    {selectedJob && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center p-4 z-40">
                            <div className="slide-up bg-white rounded-t-xl sm:rounded-xl max-w-md w-full sm:max-w-lg">
                                <div className="p-6">
                                    <div className="flex items-start gap-4 mb-4">
                                        <div className={`w-12 h-12 rounded-full ${getStatusColor(selectedJob.status)} flex-shrink-0 flex items-center justify-center`}>
                                            <div className="w-2 h-2 bg-white rounded-full opacity-30"></div>
                                        </div>
                                        <div className="flex-1">
                                            <h3 className="text-lg font-bold text-gray-900 mb-1">
                                                {selectedJob.name}
                                            </h3>
                                            <p className={`text-sm font-medium ${
                                                selectedJob.status === 'failed' ? 'text-red-600' :
                                                selectedJob.status === 'delayed' ? 'text-yellow-600' :
                                                'text-green-600'
                                            }`}>
                                                {getStatusText(selectedJob.status)} â€¢ {formatTimeAgo(selectedJob.lastRun)}
                                            </p>
                                        </div>
                                    </div>

                                    <div className="space-y-3 mb-6">
                                        <div>
                                            <p className="text-sm text-gray-500">Last run</p>
                                            <p className="text-sm font-medium text-gray-900">
                                                {selectedJob.lastRun.toLocaleString()}
                                            </p>
                                        </div>
                                        <div>
                                            <p className="text-sm text-gray-500">Last successful</p>
                                            <p className={`text-sm font-medium ${
                                                selectedJob.status === 'failed' ? 'text-red-600' : 'text-gray-900'
                                            }`}>
                                                {selectedJob.lastSuccess.toLocaleString()}
                                                {selectedJob.status === 'failed' && (
                                                    <span className="ml-2 text-red-600 font-bold">
                                                        ({formatTimeAgo(selectedJob.lastSuccess)})
                                                    </span>
                                                )}
                                            </p>
                                        </div>
                                    </div>

                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => alert('Would open D365 batch job details')}
                                            className="flex-1 bg-blue-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors"
                                        >
                                            View in D365
                                        </button>
                                        <button
                                            onClick={closeModal}
                                            className="px-4 py-3 text-gray-600 hover:text-gray-800 transition-colors"
                                        >
                                            Close
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Footer */}
                    <div className="max-w-6xl mx-auto px-4 py-8 text-center">
                        <p className="text-xs text-gray-400">
                            Built with Foundry â€¢ Updates every 5 minutes
                        </p>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<PulseCheck />, document.getElementById('root'));
    </script>
</body>
</html>